(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1648],{8623:function(e,n,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/enquiries",function(){return i(2552)}])},3836:function(e,n,i){"use strict";i.d(n,{Z:function(){return AdminGuard}});var t=i(5893),r=i(7294);function AdminGuard(e){let{children:n}=e,[i,d]=(0,r.useState)(!0),[s,a]=(0,r.useState)(!1),[l,o]=(0,r.useState)(!1),[c,u]=(0,r.useState)(""),getKey=()=>{try{return sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}catch(e){return"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}};(0,r.useEffect)(()=>{!async function(){d(!0);let e=getKey();if(!e){o(!0),d(!1);return}try{let n=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});if(n.ok){try{sessionStorage.setItem("admin_key",e)}catch(e){}a(!0)}else o(!0),sessionStorage.removeItem("admin_key")}catch(e){console.warn("Admin verify failed:",e),o(!0)}finally{d(!1)}}()},[]);let submitKey=async()=>{let e=c.trim();if(!e)return alert("Key required");d(!0);try{let n=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});n.ok?(sessionStorage.setItem("admin_key",e),a(!0),o(!1)):alert("Invalid admin key")}catch(e){alert("Network error: "+e.message)}finally{d(!1)}};return i?(0,t.jsx)("div",{style:{padding:20},children:"Checking admin access…"}):l&&!s?(0,t.jsxs)("div",{style:{padding:20,maxWidth:600,margin:"40px auto",border:"1px solid #eee",borderRadius:8},children:[(0,t.jsx)("h3",{children:"Admin Access Required"}),(0,t.jsx)("p",{children:"Enter admin key to continue (session will remember it):"}),(0,t.jsx)("input",{value:c,onChange:e=>u(e.target.value),placeholder:"Enter admin key",style:{width:"100%",padding:10,borderRadius:6,border:"1px solid #ddd"}}),(0,t.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,t.jsx)("button",{onClick:()=>{o(!1)},style:{padding:"8px 12px"},children:"Cancel"}),(0,t.jsx)("button",{onClick:submitKey,style:{padding:"8px 12px",background:"#27457a",color:"#fff",borderRadius:6},children:"Submit"})]}),(0,t.jsxs)("p",{style:{marginTop:12,fontSize:13,color:"#777"},children:["Tip: For local dev you can keep the same value as ",(0,t.jsx)("code",{children:"NEXT_PUBLIC_ADMIN_KEY"}),"."]})]}):(0,t.jsx)(t.Fragment,{children:n})}},2552:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return EnquiriesWithGuard}});var t=i(5893),r=i(7294),d=i(3836);function AdminEnquiriesPage(){let[e,n]=(0,r.useState)([]),[i,d]=(0,r.useState)(!1),[x,y]=(0,r.useState)(null),[f,g]=(0,r.useState)(null),m=sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz";async function loadLeads(){d(!0);try{let e=await fetch("/api/admin/leads/get",{headers:{"x-admin-key":m}}),i=await e.json();e.ok?n(i.leads||[]):(n([]),alert(i.error||"Failed to load enquiries"))}catch(e){alert("Failed to load enquiries: "+e.message),n([])}finally{d(!1)}}async function markRead(e,i){y(e);try{let t=await fetch("/api/admin/leads/update-status",{method:"PUT",headers:{"Content-Type":"application/json","x-admin-key":m},body:JSON.stringify({id:e,read:i})}),r=await t.json();t.ok?n(e=>e.map(e=>e._id===r.lead._id?r.lead:e)):alert(r.error||"Update failed")}catch(e){alert("Update failed: "+e.message)}finally{y(null)}}async function deleteLead(e){if(confirm("Delete this enquiry permanently?")){y(e);try{let i=await fetch("/api/admin/leads/delete",{method:"DELETE",headers:{"Content-Type":"application/json","x-admin-key":m},body:JSON.stringify({id:e})}),t=await i.json();i.ok?n(n=>n.filter(n=>n._id!==e)):alert(t.error||"Delete failed")}catch(e){alert("Delete failed: "+e.message)}finally{y(null)}}}return(0,r.useEffect)(()=>{loadLeads()},[]),(0,t.jsxs)("div",{style:{padding:20,maxWidth:1200,margin:"0 auto"},children:[(0,t.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[(0,t.jsx)("h2",{style:{margin:0},children:"Enquiries"}),(0,t.jsx)("button",{onClick:loadLeads,style:l,children:i?"Refreshing...":"Refresh"})]}),(0,t.jsx)("div",{style:{overflowX:"auto",background:"#fff",borderRadius:8,boxShadow:"0 1px 4px rgba(0,0,0,0.04)"},children:(0,t.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:900},children:[(0,t.jsx)("thead",{style:{background:"#f8fafc"},children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{style:s,children:"Name"}),(0,t.jsx)("th",{style:s,children:"Email"}),(0,t.jsx)("th",{style:s,children:"Phone"}),(0,t.jsx)("th",{style:s,children:"Property"}),(0,t.jsx)("th",{style:s,children:"Status"}),(0,t.jsx)("th",{style:s,children:"Actions"})]})}),(0,t.jsxs)("tbody",{children:[i&&0===e.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,style:{padding:20,textAlign:"center"},children:"Loading enquiries…"})}),!i&&0===e.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:6,style:{padding:20,textAlign:"center"},children:"No enquiries found."})}),e.map(e=>(0,t.jsxs)("tr",{style:{borderBottom:"1px solid #eef2f6"},children:[(0,t.jsx)("td",{style:a,children:e.name}),(0,t.jsx)("td",{style:a,children:e.email}),(0,t.jsx)("td",{style:a,children:e.phone}),(0,t.jsx)("td",{style:a,children:e.propertyTitle||"-"}),(0,t.jsx)("td",{style:a,children:e.read?"Read":"Unread"}),(0,t.jsx)("td",{style:a,children:(0,t.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,t.jsx)("button",{disabled:x===e._id,onClick:()=>g(e),style:o,children:"View"}),(0,t.jsx)("button",{disabled:x===e._id,onClick:()=>markRead(e._id,!e.read),style:o,children:x===e._id?"…":e.read?"Mark Unread":"Mark Read"}),(0,t.jsx)("button",{disabled:x===e._id,onClick:()=>deleteLead(e._id),style:c,children:x===e._id?"…":"Delete"})]})})]},e._id))]})]})}),f&&(0,t.jsx)("div",{style:h,onMouseDown:e=>{e.target===e.currentTarget&&g(null)},children:(0,t.jsxs)("div",{style:p,children:[(0,t.jsx)("h3",{style:{marginTop:0},children:"Enquiry Details"}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Name:"})," ",f.name]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Email:"})," ",f.email]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Phone:"})," ",f.phone]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Property:"})," ",f.propertyTitle]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Message:"})," ",f.message||"-"]}),(0,t.jsx)("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end",gap:8},children:(0,t.jsx)("button",{onClick:()=>g(null),style:u,children:"Close"})})]})})]})}function EnquiriesWithGuard(e){return(0,t.jsx)(d.Z,{children:(0,t.jsx)(AdminEnquiriesPage,{...e})})}let s={textAlign:"left",padding:"10px 12px",fontSize:13,color:"#374151"},a={padding:"10px 12px",fontSize:14,color:"#111827"},l={padding:"8px 12px",background:"#f3f4f6",color:"#111827",border:"1px solid #e5e7eb",borderRadius:6,cursor:"pointer"},o={padding:"6px 10px",background:"#11294a",color:"#fff",borderRadius:6,border:"none",cursor:"pointer"},c={padding:"6px 10px",background:"#ef4444",color:"#fff",borderRadius:6,border:"none",cursor:"pointer"},u={padding:"6px 10px",background:"#e5e7eb",color:"#111827",borderRadius:6,border:"none",cursor:"pointer"},h={position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1200,padding:16},p={width:"min(600px, 98%)",background:"#fff",borderRadius:10,padding:18,boxShadow:"0 6px 32px rgba(16,24,40,0.18)"}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=8623)}),_N_E=e.O()}]);