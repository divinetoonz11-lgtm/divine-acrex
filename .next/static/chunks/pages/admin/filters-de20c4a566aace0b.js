(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2822],{1529:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/filters",function(){return i(6020)}])},3836:function(e,t,i){"use strict";i.d(t,{Z:function(){return AdminGuard}});var n=i(5893),l=i(7294);function AdminGuard(e){let{children:t}=e,[i,r]=(0,l.useState)(!0),[d,s]=(0,l.useState)(!1),[a,o]=(0,l.useState)(!1),[c,u]=(0,l.useState)(""),getKey=()=>{try{return sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}catch(e){return"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}};(0,l.useEffect)(()=>{!async function(){r(!0);let e=getKey();if(!e){o(!0),r(!1);return}try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});if(t.ok){try{sessionStorage.setItem("admin_key",e)}catch(e){}s(!0)}else o(!0),sessionStorage.removeItem("admin_key")}catch(e){console.warn("Admin verify failed:",e),o(!0)}finally{r(!1)}}()},[]);let submitKey=async()=>{let e=c.trim();if(!e)return alert("Key required");r(!0);try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});t.ok?(sessionStorage.setItem("admin_key",e),s(!0),o(!1)):alert("Invalid admin key")}catch(e){alert("Network error: "+e.message)}finally{r(!1)}};return i?(0,n.jsx)("div",{style:{padding:20},children:"Checking admin accessâ€¦"}):a&&!d?(0,n.jsxs)("div",{style:{padding:20,maxWidth:600,margin:"40px auto",border:"1px solid #eee",borderRadius:8},children:[(0,n.jsx)("h3",{children:"Admin Access Required"}),(0,n.jsx)("p",{children:"Enter admin key to continue (session will remember it):"}),(0,n.jsx)("input",{value:c,onChange:e=>u(e.target.value),placeholder:"Enter admin key",style:{width:"100%",padding:10,borderRadius:6,border:"1px solid #ddd"}}),(0,n.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,n.jsx)("button",{onClick:()=>{o(!1)},style:{padding:"8px 12px"},children:"Cancel"}),(0,n.jsx)("button",{onClick:submitKey,style:{padding:"8px 12px",background:"#27457a",color:"#fff",borderRadius:6},children:"Submit"})]}),(0,n.jsxs)("p",{style:{marginTop:12,fontSize:13,color:"#777"},children:["Tip: For local dev you can keep the same value as ",(0,n.jsx)("code",{children:"NEXT_PUBLIC_ADMIN_KEY"}),"."]})]}):(0,n.jsx)(n.Fragment,{children:t})}},6020:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return FiltersWithGuard}});var n=i(5893),l=i(7294),r=i(3836);function FiltersPage(){let[e,t]=(0,l.useState)([]),[i,r]=(0,l.useState)(!1),[p,x]=(0,l.useState)(null),[y,h]=(0,l.useState)(null),[g,m]=(0,l.useState)(!1),[j,b]=(0,l.useState)(!1),k=(0,l.useRef)(null);async function loadFilters(){b(!0);try{let e=await fetch("/api/admin/filters/get",{headers:{"x-admin-key":sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}}),i=await e.json();e.ok?t(i.filters||[]):(t([]),console.warn("Load filters error:",i.error))}catch(e){console.warn("Failed to load filters:",e),t([])}finally{b(!1)}}(0,l.useEffect)(()=>{loadFilters()},[]);let openEdit=e=>{x(e),r(!0)},askDelete=e=>{h(e),m(!0)},doDelete=async()=>{if(y)try{let e=await fetch("/api/admin/filters/delete",{method:"DELETE",headers:{"Content-Type":"application/json","x-admin-key":sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"},body:JSON.stringify({id:y._id})}),i=await e.json();e.ok?t(e=>e.filter(e=>e._id!==y._id)):alert(i.error||"Delete failed")}catch(e){alert("Delete failed: "+e.message)}finally{m(!1),h(null)}};return(0,n.jsxs)("div",{style:{padding:18,maxWidth:1100,margin:"0 auto"},children:[(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12,marginBottom:18},children:[(0,n.jsx)("h2",{style:{margin:0},children:"Filters"}),(0,n.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,n.jsx)("button",{onClick:()=>{x(null),r(!0)},style:a,children:"+ Add Filter"}),(0,n.jsx)("button",{onClick:loadFilters,style:o,children:j?"Refreshing...":"Refresh"})]})]}),(0,n.jsx)("div",{style:{overflowX:"auto",background:"#fff",borderRadius:8,boxShadow:"0 1px 4px rgba(0,0,0,0.04)"},children:(0,n.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:680},children:[(0,n.jsx)("thead",{style:{background:"#f8fafc"},children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{style:d,children:"Name"}),(0,n.jsx)("th",{style:d,children:"Type"}),(0,n.jsx)("th",{style:d,children:"Values"}),(0,n.jsx)("th",{style:d,children:"Actions"})]})}),(0,n.jsxs)("tbody",{children:[e.map(e=>(0,n.jsxs)("tr",{style:{borderBottom:"1px solid #eef2f6"},children:[(0,n.jsx)("td",{style:s,children:e.name}),(0,n.jsx)("td",{style:s,children:e.type}),(0,n.jsx)("td",{style:s,children:(e.values||[]).join(", ")}),(0,n.jsx)("td",{style:s,children:(0,n.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,n.jsx)("button",{onClick:()=>openEdit(e),style:c,children:"Edit"}),(0,n.jsx)("button",{onClick:()=>askDelete(e),style:u,children:"Delete"})]})})]},e._id)),0===e.length&&(0,n.jsx)("tr",{children:(0,n.jsx)("td",{colSpan:4,style:{textAlign:"center",padding:20},children:j?"Loading...":"No filters yet."})})]})]})}),i&&(0,n.jsx)(Modal,{onClose:()=>r(!1),children:(0,n.jsx)(FilterForm,{initial:p,onClose:()=>r(!1),onSaved:e=>{if(p)t(t=>t.map(t=>t._id===e._id?e:t));else{let i=e._id||Date.now().toString();t(t=>[{_id:i,...e},...t])}},inputRef:k})}),g&&(0,n.jsx)(Modal,{onClose:()=>m(!1),children:(0,n.jsxs)("div",{style:{padding:18},children:[(0,n.jsx)("h3",{style:{marginTop:0},children:"Confirm Delete"}),(0,n.jsxs)("p",{children:["Are you sure you want to delete ",(0,n.jsx)("strong",{children:null==y?void 0:y.name}),"?"]}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[(0,n.jsx)("button",{onClick:()=>m(!1),style:f,children:"Cancel"}),(0,n.jsx)("button",{onClick:doDelete,style:u,children:"Delete"})]})]})})]})}function FilterForm(e){let{initial:t,onClose:i,onSaved:r,inputRef:d}=e,[s,o]=(0,l.useState)((null==t?void 0:t.name)||""),[c,u]=(0,l.useState)((null==t?void 0:t.type)||"text"),[y,h]=(0,l.useState)(((null==t?void 0:t.values)||[]).join(", ")),[g,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>{setTimeout(()=>{var e;return(null==d?void 0:null===(e=d.current)||void 0===e?void 0:e.focus)&&d.current.focus()},80)},[]);let handleSubmit=async e=>{e.preventDefault(),m(!0);let n={name:s.trim(),type:c,values:y.split(",").map(e=>e.trim()).filter(Boolean)};try{if(t&&t._id){let e=await fetch("/api/admin/filters/edit",{method:"PUT",headers:{"Content-Type":"application/json","x-admin-key":sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"},body:JSON.stringify({id:t._id,...n})}),i=await e.json();e.ok?r(i.filter||{_id:t._id,...n}):alert(i.error||"Update failed")}else{let e=await fetch("/api/admin/filters/add",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"},body:JSON.stringify(n)}),t=await e.json();e.ok?r(t.filter||n):alert(t.error||"Add failed")}}catch(e){alert("Save failed: "+e.message)}finally{m(!1),i()}};return(0,n.jsxs)("form",{onSubmit:handleSubmit,style:{display:"grid",gap:10,width:"100%"},children:[(0,n.jsx)("label",{style:x,children:"Filter Name"}),(0,n.jsx)("input",{ref:d,value:s,onChange:e=>o(e.target.value),required:!0,style:p}),(0,n.jsx)("label",{style:x,children:"Type"}),(0,n.jsxs)("select",{value:c,onChange:e=>u(e.target.value),style:p,children:[(0,n.jsx)("option",{value:"text",children:"Text"}),(0,n.jsx)("option",{value:"select",children:"Select"}),(0,n.jsx)("option",{value:"range",children:"Range"}),(0,n.jsx)("option",{value:"boolean",children:"Boolean"})]}),(0,n.jsx)("label",{style:x,children:"Values (comma separated)"}),(0,n.jsx)("input",{value:y,onChange:e=>h(e.target.value),placeholder:"e.g. 1,2,3 or Furnished,Unfurnished",style:p}),(0,n.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:8},children:[(0,n.jsx)("button",{type:"button",onClick:i,style:f,children:"Cancel"}),(0,n.jsx)("button",{type:"submit",style:a,disabled:g,children:g?"Saving...":"Save"})]})]})}function Modal(e){let{children:t,onClose:i}=e;return(0,l.useEffect)(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}),[]),(0,n.jsx)("div",{style:y,onMouseDown:e=>{e.target===e.currentTarget&&i&&i()},children:(0,n.jsx)("div",{style:h,role:"dialog","aria-modal":"true",children:t})})}function FiltersWithGuard(e){return(0,n.jsx)(r.Z,{children:(0,n.jsx)(FiltersPage,{...e})})}let d={textAlign:"left",padding:"12px 14px",fontSize:13,color:"#374151"},s={padding:"12px 14px",fontSize:14,color:"#111827"},a={padding:"8px 14px",background:"#27457a",color:"#fff",border:"none",borderRadius:6,cursor:"pointer"},o={padding:"8px 12px",background:"#f3f4f6",color:"#111827",border:"1px solid #e5e7eb",borderRadius:6,cursor:"pointer"},c={padding:"6px 10px",background:"#0b1c33",color:"#fff",borderRadius:6,border:"none",cursor:"pointer"},u={padding:"6px 10px",background:"#ef4444",color:"#fff",borderRadius:6,border:"none",cursor:"pointer"},f={padding:"6px 10px",background:"#e5e7eb",color:"#111827",borderRadius:6,border:"none",cursor:"pointer"},p={padding:"8px 10px",borderRadius:6,border:"1px solid #d1d5db",width:"100%",boxSizing:"border-box"},x={fontSize:13,color:"#374151"},y={position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1200,padding:16},h={width:"min(520px, 98%)",background:"#fff",borderRadius:10,padding:18,boxShadow:"0 6px 32px rgba(16,24,40,0.18)"}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=1529)}),_N_E=e.O()}]);