(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9635],{5356:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/users",function(){return s(9040)}])},3836:function(e,t,s){"use strict";s.d(t,{Z:function(){return AdminGuard}});var i=s(5893),n=s(7294);function AdminGuard(e){let{children:t}=e,[s,r]=(0,n.useState)(!0),[d,a]=(0,n.useState)(!1),[l,o]=(0,n.useState)(!1),[c,u]=(0,n.useState)(""),getKey=()=>{try{return sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}catch(e){return"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}};(0,n.useEffect)(()=>{!async function(){r(!0);let e=getKey();if(!e){o(!0),r(!1);return}try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});if(t.ok){try{sessionStorage.setItem("admin_key",e)}catch(e){}a(!0)}else o(!0),sessionStorage.removeItem("admin_key")}catch(e){console.warn("Admin verify failed:",e),o(!0)}finally{r(!1)}}()},[]);let submitKey=async()=>{let e=c.trim();if(!e)return alert("Key required");r(!0);try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});t.ok?(sessionStorage.setItem("admin_key",e),a(!0),o(!1)):alert("Invalid admin key")}catch(e){alert("Network error: "+e.message)}finally{r(!1)}};return s?(0,i.jsx)("div",{style:{padding:20},children:"Checking admin access…"}):l&&!d?(0,i.jsxs)("div",{style:{padding:20,maxWidth:600,margin:"40px auto",border:"1px solid #eee",borderRadius:8},children:[(0,i.jsx)("h3",{children:"Admin Access Required"}),(0,i.jsx)("p",{children:"Enter admin key to continue (session will remember it):"}),(0,i.jsx)("input",{value:c,onChange:e=>u(e.target.value),placeholder:"Enter admin key",style:{width:"100%",padding:10,borderRadius:6,border:"1px solid #ddd"}}),(0,i.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,i.jsx)("button",{onClick:()=>{o(!1)},style:{padding:"8px 12px"},children:"Cancel"}),(0,i.jsx)("button",{onClick:submitKey,style:{padding:"8px 12px",background:"#27457a",color:"#fff",borderRadius:6},children:"Submit"})]}),(0,i.jsxs)("p",{style:{marginTop:12,fontSize:13,color:"#777"},children:["Tip: For local dev you can keep the same value as ",(0,i.jsx)("code",{children:"NEXT_PUBLIC_ADMIN_KEY"}),"."]})]}):(0,i.jsx)(i.Fragment,{children:t})}},9040:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return UsersWithGuard}});var i=s(5893),n=s(7294),r=s(3836);function AdminUsersPage(){let[e,t]=(0,n.useState)([]),[s,r]=(0,n.useState)(!1),[u,h]=(0,n.useState)(null),f=sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz";async function loadUsers(){r(!0);try{let e=await fetch("/api/admin/users/get",{headers:{"x-admin-key":f}}),s=await e.json();e.ok?t(s.users||[]):(t([]),alert(s.error||"Failed to load users"))}catch(e){alert("Failed to load users: "+e.message),t([])}finally{r(!1)}}async function updateStatus(e,s){if(confirm('Are you sure to set status "'.concat(s,'" for this user?'))){h(e);try{let i=await fetch("/api/admin/users/update-status",{method:"PUT",headers:{"Content-Type":"application/json","x-admin-key":f},body:JSON.stringify({id:e,status:s})}),n=await i.json();i.ok?t(e=>e.map(e=>e._id===n.user._id?n.user:e)):alert(n.error||"Update failed")}catch(e){alert("Update failed: "+e.message)}finally{h(null)}}}async function deleteUser(e){if(confirm("Are you sure to permanently delete this user?")){h(e);try{let s=await fetch("/api/admin/users/delete",{method:"DELETE",headers:{"Content-Type":"application/json","x-admin-key":f},body:JSON.stringify({id:e})}),i=await s.json();s.ok?t(t=>t.filter(t=>t._id!==e)):alert(i.error||"Delete failed")}catch(e){alert("Delete failed: "+e.message)}finally{h(null)}}}return(0,n.useEffect)(()=>{loadUsers()},[]),(0,i.jsxs)("div",{style:{padding:20,maxWidth:1200,margin:"0 auto"},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[(0,i.jsx)("h2",{style:{margin:0},children:"Users"}),(0,i.jsx)("div",{style:{display:"flex",gap:8},children:(0,i.jsx)("button",{onClick:loadUsers,style:l,children:s?"Refreshing...":"Refresh"})})]}),(0,i.jsx)("div",{style:{overflowX:"auto",background:"#fff",borderRadius:8,boxShadow:"0 1px 4px rgba(0,0,0,0.04)"},children:(0,i.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:760},children:[(0,i.jsx)("thead",{style:{background:"#f8fafc"},children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{style:d,children:"Name"}),(0,i.jsx)("th",{style:d,children:"Email"}),(0,i.jsx)("th",{style:d,children:"Phone"}),(0,i.jsx)("th",{style:d,children:"Status"}),(0,i.jsx)("th",{style:d,children:"Actions"})]})}),(0,i.jsxs)("tbody",{children:[s&&0===e.length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:5,style:{padding:20,textAlign:"center"},children:"Loading users…"})}),!s&&0===e.length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:5,style:{padding:20,textAlign:"center"},children:"No users found."})}),e.map(e=>(0,i.jsxs)("tr",{style:{borderBottom:"1px solid #eef2f6"},children:[(0,i.jsx)("td",{style:a,children:e.name||"-"}),(0,i.jsx)("td",{style:a,children:e.email||"-"}),(0,i.jsx)("td",{style:a,children:e.phone||"-"}),(0,i.jsx)("td",{style:a,children:e.status||"active"}),(0,i.jsx)("td",{style:a,children:(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("button",{disabled:u===e._id,onClick:()=>updateStatus(e._id,"blocked"===e.status?"active":"blocked"),style:o,children:u===e._id?"…":"blocked"===e.status?"Activate":"Block"}),(0,i.jsx)("button",{disabled:u===e._id,onClick:()=>deleteUser(e._id),style:c,children:u===e._id?"…":"Delete"})]})})]},e._id))]})]})})]})}function UsersWithGuard(e){return(0,i.jsx)(r.Z,{children:(0,i.jsx)(AdminUsersPage,{...e})})}let d={textAlign:"left",padding:"12px 14px",fontSize:13,color:"#374151"},a={padding:"12px 14px",fontSize:14,color:"#111827"},l={padding:"8px 12px",background:"#f3f4f6",color:"#111827",border:"1px solid #e5e7eb",borderRadius:6,cursor:"pointer"},o={padding:"6px 10px",background:"#11294a",color:"#fff",borderRadius:6,border:"none",cursor:"pointer"},c={padding:"6px 10px",background:"#ef4444",color:"#fff",borderRadius:6,border:"none",cursor:"pointer"}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=5356)}),_N_E=e.O()}]);