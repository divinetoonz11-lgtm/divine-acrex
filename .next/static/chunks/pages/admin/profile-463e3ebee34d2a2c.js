(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8172],{4354:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/profile",function(){return a(610)}])},3836:function(e,t,a){"use strict";a.d(t,{Z:function(){return AdminGuard}});var i=a(5893),n=a(7294);function AdminGuard(e){let{children:t}=e,[a,r]=(0,n.useState)(!0),[s,l]=(0,n.useState)(!1),[o,d]=(0,n.useState)(!1),[c,p]=(0,n.useState)(""),getKey=()=>{try{return sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}catch(e){return"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}};(0,n.useEffect)(()=>{!async function(){r(!0);let e=getKey();if(!e){d(!0),r(!1);return}try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});if(t.ok){try{sessionStorage.setItem("admin_key",e)}catch(e){}l(!0)}else d(!0),sessionStorage.removeItem("admin_key")}catch(e){console.warn("Admin verify failed:",e),d(!0)}finally{r(!1)}}()},[]);let submitKey=async()=>{let e=c.trim();if(!e)return alert("Key required");r(!0);try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});t.ok?(sessionStorage.setItem("admin_key",e),l(!0),d(!1)):alert("Invalid admin key")}catch(e){alert("Network error: "+e.message)}finally{r(!1)}};return a?(0,i.jsx)("div",{style:{padding:20},children:"Checking admin accessâ€¦"}):o&&!s?(0,i.jsxs)("div",{style:{padding:20,maxWidth:600,margin:"40px auto",border:"1px solid #eee",borderRadius:8},children:[(0,i.jsx)("h3",{children:"Admin Access Required"}),(0,i.jsx)("p",{children:"Enter admin key to continue (session will remember it):"}),(0,i.jsx)("input",{value:c,onChange:e=>p(e.target.value),placeholder:"Enter admin key",style:{width:"100%",padding:10,borderRadius:6,border:"1px solid #ddd"}}),(0,i.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,i.jsx)("button",{onClick:()=>{d(!1)},style:{padding:"8px 12px"},children:"Cancel"}),(0,i.jsx)("button",{onClick:submitKey,style:{padding:"8px 12px",background:"#27457a",color:"#fff",borderRadius:6},children:"Submit"})]}),(0,i.jsxs)("p",{style:{marginTop:12,fontSize:13,color:"#777"},children:["Tip: For local dev you can keep the same value as ",(0,i.jsx)("code",{children:"NEXT_PUBLIC_ADMIN_KEY"}),"."]})]}):(0,i.jsx)(i.Fragment,{children:t})}},610:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return ProfileWithGuard}});var i=a(5893),n=a(7294),r=a(3836);function ProfilePage(){let[e,t]=(0,n.useState)({name:"",email:"",phone:""}),[a,r]=(0,n.useState)(!1),[p,u]=(0,n.useState)(!1),[h,g]=(0,n.useState)(""),[y,f]=(0,n.useState)(""),[m,x]=(0,n.useState)(""),[v,j]=(0,n.useState)(!1),[b,w]=(0,n.useState)(""),S=(0,n.useRef)(null);(0,n.useEffect)(()=>{try{let e=localStorage.getItem("admin_profile");if(e)t(JSON.parse(e));else{let e=sessionStorage.getItem("admin_name")||"",a=sessionStorage.getItem("admin_email")||"";(e||a)&&t({name:e,email:a,phone:""})}let a=localStorage.getItem("admin_profile_photo");a&&w(a)}catch(e){console.warn("Failed to load admin profile",e)}},[]);let saveProfile=async()=>{u(!0);try{let t={...e},a=!1;try{let e=await fetch("/api/admin/profile/save",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"},body:JSON.stringify(t)});e.ok&&(a=!0)}catch(e){}localStorage.setItem("admin_profile",JSON.stringify(e)),alert(a?"Profile saved on server":"Profile saved locally"),r(!1)}catch(e){alert("Save failed: "+e.message)}finally{u(!1)}},changePassword=async()=>{if(!h||!y)return alert("Old and new password required");if(y!==m)return alert("New password and confirm password do not match");j(!0);try{try{let e=await fetch("/api/admin/profile/change-password",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"},body:JSON.stringify({oldPassword:h,newPassword:y})});if(e.ok){alert("Password changed (server)"),g(""),f(""),x("");return}}catch(e){}alert("Password change simulated locally (no server)"),g(""),f(""),x("")}catch(e){alert("Password change failed: "+e.message)}finally{j(!1)}};return(0,i.jsxs)("div",{style:{padding:20,maxWidth:900,margin:"0 auto"},children:[(0,i.jsx)("h2",{style:{marginTop:0},children:"Admin Profile"}),(0,i.jsxs)("div",{style:{display:"flex",gap:20,alignItems:"flex-start",marginTop:12},children:[(0,i.jsxs)("div",{style:{width:180},children:[(0,i.jsx)("div",{style:{width:160,height:160,borderRadius:8,overflow:"hidden",background:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center"},children:b?(0,i.jsx)("img",{src:b,alt:"Profile",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,i.jsxs)("div",{style:{textAlign:"center",color:"#64748b"},children:[(0,i.jsx)("div",{style:{fontSize:28,fontWeight:700},children:(e.name||"A").charAt(0).toUpperCase()}),(0,i.jsx)("div",{style:{fontSize:12},children:"No photo"})]})}),(0,i.jsxs)("div",{style:{marginTop:10,display:"flex",gap:8,flexWrap:"wrap"},children:[(0,i.jsxs)("label",{style:c,children:["Upload",(0,i.jsx)("input",{ref:S,onChange:e=>{let t=e.target.files&&e.target.files[0];if(!t)return;let a=new FileReader;a.onload=function(e){w(e.target.result);try{localStorage.setItem("admin_profile_photo",e.target.result)}catch(e){console.warn("Cannot save photo to localStorage",e)}},a.readAsDataURL(t)},type:"file",accept:"image/*",style:{display:"none"}})]}),(0,i.jsx)("button",{onClick:()=>{w("");try{localStorage.removeItem("admin_profile_photo")}catch(e){}S.current&&(S.current.value="")},style:d,children:"Remove"})]})]}),(0,i.jsxs)("div",{style:{flex:1},children:[(0,i.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)("h3",{style:{margin:0},children:"Account"}),a?(0,i.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,i.jsx)("button",{onClick:()=>{try{let e=localStorage.getItem("admin_profile");e&&t(JSON.parse(e))}catch(e){}r(!1)},style:d,children:"Cancel"}),(0,i.jsx)("button",{onClick:saveProfile,style:o,disabled:p,children:p?"Saving...":"Save"})]}):(0,i.jsx)("div",{style:{display:"flex",gap:8},children:(0,i.jsx)("button",{onClick:()=>r(!0),style:o,children:"Edit"})})]}),(0,i.jsxs)("div",{style:{marginTop:12},children:[(0,i.jsx)("label",{style:l,children:"Name"}),(0,i.jsx)("input",{value:e.name,onChange:e=>t(t=>({...t,name:e.target.value})),disabled:!a,style:s}),(0,i.jsx)("label",{style:{...l,marginTop:8},children:"Email"}),(0,i.jsx)("input",{value:e.email,onChange:e=>t(t=>({...t,email:e.target.value})),disabled:!a,style:s}),(0,i.jsx)("label",{style:{...l,marginTop:8},children:"Phone"}),(0,i.jsx)("input",{value:e.phone,onChange:e=>t(t=>({...t,phone:e.target.value})),disabled:!a,style:s})]}),(0,i.jsxs)("div",{style:{marginTop:18,borderTop:"1px solid #f3f4f6",paddingTop:14},children:[(0,i.jsx)("h4",{style:{margin:"0 0 8px 0"},children:"Change Password"}),(0,i.jsxs)("div",{style:{maxWidth:480},children:[(0,i.jsx)("label",{style:l,children:"Old password"}),(0,i.jsx)("input",{type:"password",value:h,onChange:e=>g(e.target.value),style:s}),(0,i.jsx)("label",{style:{...l,marginTop:8},children:"New password"}),(0,i.jsx)("input",{type:"password",value:y,onChange:e=>f(e.target.value),style:s}),(0,i.jsx)("label",{style:{...l,marginTop:8},children:"Confirm new password"}),(0,i.jsx)("input",{type:"password",value:m,onChange:e=>x(e.target.value),style:s}),(0,i.jsxs)("div",{style:{marginTop:10,display:"flex",gap:8},children:[(0,i.jsx)("button",{onClick:changePassword,disabled:v,style:o,children:v?"Saving...":"Change Password"}),(0,i.jsx)("button",{onClick:()=>{g(""),f(""),x("")},style:d,children:"Clear"})]})]})]})]})]})]})}function ProfileWithGuard(e){return(0,i.jsx)(r.Z,{children:(0,i.jsx)(ProfilePage,{...e})})}let s={width:"100%",padding:"8px 10px",borderRadius:6,border:"1px solid #d1d5db",boxSizing:"border-box",marginTop:6},l={fontSize:13,color:"#374151",display:"block",marginTop:8},o={padding:"8px 12px",background:"#27457a",color:"#fff",border:"none",borderRadius:6,cursor:"pointer"},d={padding:"8px 12px",background:"#e5e7eb",color:"#111827",border:"none",borderRadius:6,cursor:"pointer"},c={padding:"8px 12px",background:"#f3f4f6",color:"#111827",borderRadius:6,cursor:"pointer",display:"inline-block",position:"relative",overflow:"hidden"}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=4354)}),_N_E=e.O()}]);