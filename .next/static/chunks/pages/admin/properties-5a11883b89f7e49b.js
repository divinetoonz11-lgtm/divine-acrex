(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2521],{88:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/properties",function(){return i(9452)}])},3836:function(e,t,i){"use strict";i.d(t,{Z:function(){return AdminGuard}});var r=i(5893),n=i(7294);function AdminGuard(e){let{children:t}=e,[i,d]=(0,n.useState)(!0),[a,s]=(0,n.useState)(!1),[l,o]=(0,n.useState)(!1),[c,p]=(0,n.useState)(""),getKey=()=>{try{return sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}catch(e){return"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}};(0,n.useEffect)(()=>{!async function(){d(!0);let e=getKey();if(!e){o(!0),d(!1);return}try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});if(t.ok){try{sessionStorage.setItem("admin_key",e)}catch(e){}s(!0)}else o(!0),sessionStorage.removeItem("admin_key")}catch(e){console.warn("Admin verify failed:",e),o(!0)}finally{d(!1)}}()},[]);let submitKey=async()=>{let e=c.trim();if(!e)return alert("Key required");d(!0);try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});t.ok?(sessionStorage.setItem("admin_key",e),s(!0),o(!1)):alert("Invalid admin key")}catch(e){alert("Network error: "+e.message)}finally{d(!1)}};return i?(0,r.jsx)("div",{style:{padding:20},children:"Checking admin access…"}):l&&!a?(0,r.jsxs)("div",{style:{padding:20,maxWidth:600,margin:"40px auto",border:"1px solid #eee",borderRadius:8},children:[(0,r.jsx)("h3",{children:"Admin Access Required"}),(0,r.jsx)("p",{children:"Enter admin key to continue (session will remember it):"}),(0,r.jsx)("input",{value:c,onChange:e=>p(e.target.value),placeholder:"Enter admin key",style:{width:"100%",padding:10,borderRadius:6,border:"1px solid #ddd"}}),(0,r.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,r.jsx)("button",{onClick:()=>{o(!1)},style:{padding:"8px 12px"},children:"Cancel"}),(0,r.jsx)("button",{onClick:submitKey,style:{padding:"8px 12px",background:"#27457a",color:"#fff",borderRadius:6},children:"Submit"})]}),(0,r.jsxs)("p",{style:{marginTop:12,fontSize:13,color:"#777"},children:["Tip: For local dev you can keep the same value as ",(0,r.jsx)("code",{children:"NEXT_PUBLIC_ADMIN_KEY"}),"."]})]}):(0,r.jsx)(r.Fragment,{children:t})}},9452:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return PropertiesWithGuard}});var r=i(5893),n=i(7294),d=i(3836);function AdminPropertiesPage(){let[e,t]=(0,n.useState)([]),[i,d]=(0,n.useState)(!1),[y,f]=(0,n.useState)(null),[x,g]=(0,n.useState)(null),m=sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz";async function loadProperties(){d(!0);try{let e=await fetch("/api/admin/properties/get",{headers:{"x-admin-key":m}}),i=await e.json();e.ok?t(i.properties||[]):(t([]),alert(i.error||"Failed to load properties"))}catch(e){t([]),alert("Failed to load properties: "+e.message)}finally{d(!1)}}async function performAction(e,i){if(confirm("Confirm ".concat(i," for this property?"))){f(e);try{let r=await fetch("/api/admin/properties/action",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":m},body:JSON.stringify({id:e,action:i})}),n=await r.json();r.ok?n.property?t(e=>e.map(e=>e._id===n.property._id?n.property:e)):await loadProperties():alert(n.error||"Action failed")}catch(e){alert("Action failed: "+e.message)}finally{f(null)}}}async function updateStatus(e,i){if(confirm('Set status "'.concat(i,'" for this property?'))){f(e);try{let r=await fetch("/api/admin/properties/update-status",{method:"PUT",headers:{"Content-Type":"application/json","x-admin-key":m},body:JSON.stringify({id:e,status:i})}),n=await r.json();r.ok?t(e=>e.map(e=>e._id===n.property._id?n.property:e)):alert(n.error||"Update failed")}catch(e){alert("Update failed: "+e.message)}finally{f(null)}}}async function deleteProperty(e){if(confirm("Permanently delete this property?")){f(e);try{let i=await fetch("/api/admin/properties/delete",{method:"DELETE",headers:{"Content-Type":"application/json","x-admin-key":m},body:JSON.stringify({id:e})}),r=await i.json();i.ok?t(t=>t.filter(t=>t._id!==e)):alert(r.error||"Delete failed")}catch(e){alert("Delete failed: "+e.message)}finally{f(null)}}}return(0,n.useEffect)(()=>{loadProperties()},[]),(0,r.jsxs)("div",{style:{padding:20,maxWidth:1200,margin:"0 auto"},children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[(0,r.jsx)("h2",{style:{margin:0},children:"Properties"}),(0,r.jsx)("div",{style:{display:"flex",gap:8},children:(0,r.jsx)("button",{onClick:loadProperties,style:l,children:i?"Refreshing...":"Refresh"})})]}),(0,r.jsx)("div",{style:{overflowX:"auto",background:"#fff",borderRadius:8,boxShadow:"0 1px 4px rgba(0,0,0,0.04)"},children:(0,r.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:900},children:[(0,r.jsx)("thead",{style:{background:"#f8fafc"},children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{style:a,children:"Title"}),(0,r.jsx)("th",{style:a,children:"Dealer"}),(0,r.jsx)("th",{style:a,children:"Price"}),(0,r.jsx)("th",{style:a,children:"Location"}),(0,r.jsx)("th",{style:a,children:"Status"}),(0,r.jsx)("th",{style:a,children:"Actions"})]})}),(0,r.jsxs)("tbody",{children:[i&&0===e.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,style:{padding:20,textAlign:"center"},children:"Loading properties…"})}),!i&&0===e.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{colSpan:6,style:{padding:20,textAlign:"center"},children:"No properties found."})}),e.map(e=>(0,r.jsxs)("tr",{style:{borderBottom:"1px solid #eef2f6"},children:[(0,r.jsx)("td",{style:s,children:e.title||"-"}),(0,r.jsx)("td",{style:s,children:e.dealer&&e.dealer.name||e.dealerName||"-"}),(0,r.jsx)("td",{style:s,children:e.price?"number"==typeof e.price?e.price.toLocaleString():e.price:"-"}),(0,r.jsx)("td",{style:s,children:e.location||"-"}),(0,r.jsx)("td",{style:s,children:e.status||"pending"}),(0,r.jsx)("td",{style:s,children:(0,r.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,r.jsx)("button",{disabled:y===e._id,onClick:()=>g(e),style:o,children:"View"}),(0,r.jsx)("button",{disabled:y===e._id,onClick:()=>performAction(e._id,"approved"===e.status?"reject":"approve"),style:o,children:y===e._id?"…":"approved"===e.status?"Reject":"Approve"}),(0,r.jsx)("button",{disabled:y===e._id,onClick:()=>updateStatus(e._id,"deactivated"===e.status?"active":"deactivated"),style:o,children:y===e._id?"…":"deactivated"===e.status?"Activate":"Deactivate"}),(0,r.jsx)("button",{disabled:y===e._id,onClick:()=>deleteProperty(e._id),style:c,children:y===e._id?"…":"Delete"})]})})]},e._id))]})]})}),x&&(0,r.jsx)("div",{style:u,onMouseDown:e=>{e.target===e.currentTarget&&g(null)},children:(0,r.jsxs)("div",{style:h,children:[(0,r.jsx)("h3",{style:{marginTop:0},children:x.title}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Dealer:"})," ",x.dealer&&x.dealer.name||x.dealerName||"-"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Price:"})," ",x.price||"-"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Location:"})," ",x.location||"-"]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Status:"})," ",x.status||"-"]}),(0,r.jsx)("div",{style:{marginTop:12,display:"flex",justifyContent:"flex-end",gap:8},children:(0,r.jsx)("button",{onClick:()=>g(null),style:p,children:"Close"})})]})})]})}function PropertiesWithGuard(e){return(0,r.jsx)(d.Z,{children:(0,r.jsx)(AdminPropertiesPage,{...e})})}let a={textAlign:"left",padding:"10px 12px",fontSize:13,color:"#374151"},s={padding:"10px 12px",fontSize:14,color:"#111827"},l={padding:"8px 12px",background:"#f3f4f6",color:"#111827",border:"1px solid #e5e7eb",borderRadius:6,cursor:"pointer"},o={padding:"6px 10px",background:"#11294a",color:"#fff",borderRadius:6,border:"none",cursor:"pointer"},c={padding:"6px 10px",background:"#ef4444",color:"#fff",borderRadius:6,border:"none",cursor:"pointer"},p={padding:"6px 10px",background:"#e5e7eb",color:"#111827",borderRadius:6,border:"none",cursor:"pointer"},u={position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1200,padding:16},h={width:"min(720px, 98%)",background:"#fff",borderRadius:10,padding:18,boxShadow:"0 6px 32px rgba(16,24,40,0.18)"}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=88)}),_N_E=e.O()}]);