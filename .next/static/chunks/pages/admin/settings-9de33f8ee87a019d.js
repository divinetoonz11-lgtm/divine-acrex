(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[577],{1038:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/settings",function(){return n(6147)}])},3836:function(e,t,n){"use strict";n.d(t,{Z:function(){return AdminGuard}});var r=n(5893),i=n(7294);function AdminGuard(e){let{children:t}=e,[n,s]=(0,i.useState)(!0),[a,o]=(0,i.useState)(!1),[d,l]=(0,i.useState)(!1),[c,y]=(0,i.useState)(""),getKey=()=>{try{return sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}catch(e){return"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}};(0,i.useEffect)(()=>{!async function(){s(!0);let e=getKey();if(!e){l(!0),s(!1);return}try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});if(t.ok){try{sessionStorage.setItem("admin_key",e)}catch(e){}o(!0)}else l(!0),sessionStorage.removeItem("admin_key")}catch(e){console.warn("Admin verify failed:",e),l(!0)}finally{s(!1)}}()},[]);let submitKey=async()=>{let e=c.trim();if(!e)return alert("Key required");s(!0);try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});t.ok?(sessionStorage.setItem("admin_key",e),o(!0),l(!1)):alert("Invalid admin key")}catch(e){alert("Network error: "+e.message)}finally{s(!1)}};return n?(0,r.jsx)("div",{style:{padding:20},children:"Checking admin access…"}):d&&!a?(0,r.jsxs)("div",{style:{padding:20,maxWidth:600,margin:"40px auto",border:"1px solid #eee",borderRadius:8},children:[(0,r.jsx)("h3",{children:"Admin Access Required"}),(0,r.jsx)("p",{children:"Enter admin key to continue (session will remember it):"}),(0,r.jsx)("input",{value:c,onChange:e=>y(e.target.value),placeholder:"Enter admin key",style:{width:"100%",padding:10,borderRadius:6,border:"1px solid #ddd"}}),(0,r.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,r.jsx)("button",{onClick:()=>{l(!1)},style:{padding:"8px 12px"},children:"Cancel"}),(0,r.jsx)("button",{onClick:submitKey,style:{padding:"8px 12px",background:"#27457a",color:"#fff",borderRadius:6},children:"Submit"})]}),(0,r.jsxs)("p",{style:{marginTop:12,fontSize:13,color:"#777"},children:["Tip: For local dev you can keep the same value as ",(0,r.jsx)("code",{children:"NEXT_PUBLIC_ADMIN_KEY"}),"."]})]}):(0,r.jsx)(r.Fragment,{children:t})}},6147:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return SettingsWithGuard}});var r=n(5893),i=n(7294),s=n(3836);function SettingsPage(){let[e,t]=(0,i.useState)(""),[n,s]=(0,i.useState)(!1),[p,g]=(0,i.useState)(!1),[u,h]=(0,i.useState)(!1),[f,m]=(0,i.useState)(!1),[x,v]=(0,i.useState)(!1);(0,i.useEffect)(()=>{let e=sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz";t(e);try{let e=localStorage.getItem("admin_settings");if(e){let t=JSON.parse(e);h(!!t.notifyNewUser),m(!!t.notifyNewLead),v(!!t.notifyErrors)}}catch(e){console.warn("Failed to read admin settings",e)}},[]);let copyKey=async()=>{try{await navigator.clipboard.writeText(e||""),alert("Admin key copied to clipboard")}catch(e){alert("Copy failed — please select and copy manually")}},toggleAndSave=(e,t)=>{"user"===e&&h(t),"lead"===e&&m(t),"errors"===e&&v(t);try{localStorage.setItem("admin_settings",JSON.stringify({notifyNewUser:"user"===e?t:u,notifyNewLead:"lead"===e?t:f,notifyErrors:"errors"===e?t:x}))}catch(e){console.warn("Failed to save admin settings",e)}},saveToServerIfAvailable=async()=>{g(!0);try{let e=await fetch("/api/admin/settings/save",{method:"POST",headers:{"Content-Type":"application/json","x-admin-key":sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"},body:JSON.stringify({notifyNewUser:u,notifyNewLead:f,notifyErrors:x})});e.ok?alert("Settings saved"):(console.warn("Server settings save failed"),alert("Saved locally (server not available)"))}catch(e){console.warn("Server save error",e),alert("Saved locally (server not available)")}finally{g(!1)}};return(0,r.jsxs)("div",{style:{padding:20,maxWidth:900,margin:"0 auto"},children:[(0,r.jsx)("h2",{style:{marginTop:0},children:"Admin Settings"}),(0,r.jsxs)("section",{style:a,children:[(0,r.jsx)("h3",{style:{marginTop:0},children:"Admin API Key"}),(0,r.jsx)("p",{style:{marginTop:4,marginBottom:8,color:"#555"},children:"The admin key is used to call protected admin APIs. Never expose your real backend keys publicly."}),(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,flexWrap:"wrap"},children:[(0,r.jsx)("div",{style:{fontFamily:"monospace",background:"#f3f4f6",padding:"8px 12px",borderRadius:6},children:(e=>{if(!e)return"Not set";if(n)return e;if(e.length<=8)return e[0]+"••••"+e.slice(-1);let t=e.slice(0,4),r=e.slice(-4);return"".concat(t,"••••••").concat(r)})(e)}),(0,r.jsx)("button",{onClick:()=>s(e=>!e),style:d,children:n?"Hide":"Show"}),(0,r.jsx)("button",{onClick:copyKey,style:o,children:"Copy"}),(0,r.jsx)("button",{onClick:()=>{let e=confirm("To change the admin key you must update .env.local or rotate the key on the server. Open instructions?");e&&alert("Rotate Admin Key — steps (manual):\n1) Edit .env.local on server/project and change ADMIN_API_KEY and NEXT_PUBLIC_ADMIN_KEY (if needed).\n2) Restart Next.js server (npm run dev or redeploy).\n3) If using Vercel, update project environment variables and redeploy.\nDo not paste secrets in public channels.")},style:l,children:"Rotate / Change"})]}),(0,r.jsxs)("div",{style:{marginTop:12,color:"#666",fontSize:13},children:["Tip: For local dev you can keep admin key in ",(0,r.jsx)("code",{children:"NEXT_PUBLIC_ADMIN_KEY"})," for convenience."]})]}),(0,r.jsxs)("section",{style:{...a,marginTop:16},children:[(0,r.jsx)("h3",{style:{marginTop:0},children:"Notifications"}),(0,r.jsx)("p",{style:{marginTop:4,marginBottom:8,color:"#555"},children:"Toggle what admin should be notified about."}),(0,r.jsxs)("div",{style:{display:"grid",gap:8},children:[(0,r.jsxs)("label",{style:y,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:600},children:"New User Registrations"}),(0,r.jsx)("div",{style:{fontSize:13,color:"#666"},children:"Notify when a new user registers."})]}),(0,r.jsx)("input",{type:"checkbox",checked:u,onChange:e=>toggleAndSave("user",e.target.checked)})]}),(0,r.jsxs)("label",{style:y,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:600},children:"New Leads / Enquiries"}),(0,r.jsx)("div",{style:{fontSize:13,color:"#666"},children:"Notify on incoming leads."})]}),(0,r.jsx)("input",{type:"checkbox",checked:f,onChange:e=>toggleAndSave("lead",e.target.checked)})]}),(0,r.jsxs)("label",{style:y,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{style:{fontWeight:600},children:"Critical Errors"}),(0,r.jsx)("div",{style:{fontSize:13,color:"#666"},children:"Notify when server errors are reported."})]}),(0,r.jsx)("input",{type:"checkbox",checked:x,onChange:e=>toggleAndSave("errors",e.target.checked)})]})]}),(0,r.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,r.jsx)("button",{onClick:()=>{let e=localStorage.getItem("admin_settings");if(e){let t=JSON.parse(e);h(!!t.notifyNewUser),m(!!t.notifyNewLead),v(!!t.notifyErrors),alert("Restored saved settings")}else h(!1),m(!1),v(!1),alert("Cleared to defaults")},style:c,children:"Reset"}),(0,r.jsx)("button",{onClick:saveToServerIfAvailable,style:o,disabled:p,children:p?"Saving...":"Save Settings"})]})]}),(0,r.jsxs)("section",{style:{...a,marginTop:16},children:[(0,r.jsx)("h3",{style:{marginTop:0},children:"Advanced"}),(0,r.jsx)("p",{style:{color:"#666",marginTop:6},children:"Actions like rotating the admin key or changing environment variables must be done on the server or hosting provider."}),(0,r.jsx)("div",{style:{marginTop:8},children:(0,r.jsx)("button",{onClick:()=>{alert("Recommended: Use MongoDB Atlas for production, and store ADMIN_API_KEY in hosting env variables (Vercel/Netlify).")},style:d,children:"Deployment Tips"})})]})]})}function SettingsWithGuard(e){return(0,r.jsx)(s.Z,{children:(0,r.jsx)(SettingsPage,{...e})})}let a={background:"#fff",padding:16,borderRadius:8,boxShadow:"0 1px 6px rgba(0,0,0,0.04)"},o={padding:"8px 12px",background:"#27457a",color:"#fff",border:"none",borderRadius:6,cursor:"pointer"},d={padding:"8px 12px",background:"#f3f4f6",color:"#111827",border:"1px solid #e5e7eb",borderRadius:6,cursor:"pointer"},l={padding:"8px 12px",background:"#f59e0b",color:"#fff",border:"none",borderRadius:6,cursor:"pointer"},c={padding:"8px 12px",background:"#e5e7eb",color:"#111827",border:"none",borderRadius:6,cursor:"pointer"},y={display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 0",borderBottom:"1px solid #f3f4f6"}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=1038)}),_N_E=e.O()}]);