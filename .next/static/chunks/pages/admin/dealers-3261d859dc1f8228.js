(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2407],{1515:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/dealers",function(){return i(6953)}])},3836:function(e,t,i){"use strict";i.d(t,{Z:function(){return AdminGuard}});var a=i(5893),d=i(7294);function AdminGuard(e){let{children:t}=e,[i,n]=(0,d.useState)(!0),[r,s]=(0,d.useState)(!1),[l,o]=(0,d.useState)(!1),[c,u]=(0,d.useState)(""),getKey=()=>{try{return sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}catch(e){return"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz"}};(0,d.useEffect)(()=>{!async function(){n(!0);let e=getKey();if(!e){o(!0),n(!1);return}try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});if(t.ok){try{sessionStorage.setItem("admin_key",e)}catch(e){}s(!0)}else o(!0),sessionStorage.removeItem("admin_key")}catch(e){console.warn("Admin verify failed:",e),o(!0)}finally{n(!1)}}()},[]);let submitKey=async()=>{let e=c.trim();if(!e)return alert("Key required");n(!0);try{let t=await fetch("/api/admin/overview",{headers:{"x-admin-key":e}});t.ok?(sessionStorage.setItem("admin_key",e),s(!0),o(!1)):alert("Invalid admin key")}catch(e){alert("Network error: "+e.message)}finally{n(!1)}};return i?(0,a.jsx)("div",{style:{padding:20},children:"Checking admin access…"}):l&&!r?(0,a.jsxs)("div",{style:{padding:20,maxWidth:600,margin:"40px auto",border:"1px solid #eee",borderRadius:8},children:[(0,a.jsx)("h3",{children:"Admin Access Required"}),(0,a.jsx)("p",{children:"Enter admin key to continue (session will remember it):"}),(0,a.jsx)("input",{value:c,onChange:e=>u(e.target.value),placeholder:"Enter admin key",style:{width:"100%",padding:10,borderRadius:6,border:"1px solid #ddd"}}),(0,a.jsxs)("div",{style:{marginTop:12,display:"flex",gap:8,justifyContent:"flex-end"},children:[(0,a.jsx)("button",{onClick:()=>{o(!1)},style:{padding:"8px 12px"},children:"Cancel"}),(0,a.jsx)("button",{onClick:submitKey,style:{padding:"8px 12px",background:"#27457a",color:"#fff",borderRadius:6},children:"Submit"})]}),(0,a.jsxs)("p",{style:{marginTop:12,fontSize:13,color:"#777"},children:["Tip: For local dev you can keep the same value as ",(0,a.jsx)("code",{children:"NEXT_PUBLIC_ADMIN_KEY"}),"."]})]}):(0,a.jsx)(a.Fragment,{children:t})}},6953:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return DealersWithGuard}});var a=i(5893),d=i(7294),n=i(3836);function AdminDealersPage(){let[e,t]=(0,d.useState)([]),[i,n]=(0,d.useState)(!1),[u,h]=(0,d.useState)(null),p=sessionStorage.getItem("admin_key")||"mxNpQUAq7chKY1CBJVyOEkRgTMsbL3ferwIju0Wz";async function loadDealers(){n(!0);try{let e=await fetch("/api/admin/dealers/get",{headers:{"x-admin-key":p}}),i=await e.json();e.ok?t(i.dealers||[]):(t([]),alert(i.error||"Failed to load dealers"))}catch(e){t([]),alert("Failed to load dealers: "+e.message)}finally{n(!1)}}async function updateStatus(e,i){if(confirm('Confirm set status "'.concat(i,'"?'))){h(e);try{let a=await fetch("/api/admin/dealers/update-status",{method:"PUT",headers:{"Content-Type":"application/json","x-admin-key":p},body:JSON.stringify({id:e,status:i})}),d=await a.json();a.ok?t(e=>e.map(e=>e._id===d.dealer._id?d.dealer:e)):alert(d.error||"Update failed")}catch(e){alert("Update failed: "+e.message)}finally{h(null)}}}async function deleteDealer(e){if(confirm("Are you sure to delete this dealer?")){h(e);try{let i=await fetch("/api/admin/dealers/delete",{method:"DELETE",headers:{"Content-Type":"application/json","x-admin-key":p},body:JSON.stringify({id:e})}),a=await i.json();i.ok?t(t=>t.filter(t=>t._id!==e)):alert(a.error||"Delete failed")}catch(e){alert("Delete failed: "+e.message)}finally{h(null)}}}return(0,d.useEffect)(()=>{loadDealers()},[]),(0,a.jsxs)("div",{style:{padding:20,maxWidth:1200,margin:"0 auto"},children:[(0,a.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:14},children:[(0,a.jsx)("h2",{style:{margin:0},children:"Dealers"}),(0,a.jsx)("div",{style:{display:"flex",gap:8},children:(0,a.jsx)("button",{onClick:loadDealers,style:l,children:i?"Refreshing...":"Refresh"})})]}),(0,a.jsx)("div",{style:{overflowX:"auto",background:"#fff",borderRadius:8,boxShadow:"0 1px 4px rgba(0,0,0,0.04)"},children:(0,a.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",minWidth:760},children:[(0,a.jsx)("thead",{style:{background:"#f8fafc"},children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{style:r,children:"Name"}),(0,a.jsx)("th",{style:r,children:"Email"}),(0,a.jsx)("th",{style:r,children:"Phone"}),(0,a.jsx)("th",{style:r,children:"Status"}),(0,a.jsx)("th",{style:r,children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[i&&0===e.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,style:{padding:20,textAlign:"center"},children:"Loading dealers…"})}),!i&&0===e.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,style:{padding:20,textAlign:"center"},children:"No dealers found."})}),e.map(e=>(0,a.jsxs)("tr",{style:{borderBottom:"1px solid #eef2f6"},children:[(0,a.jsx)("td",{style:s,children:e.name||"-"}),(0,a.jsx)("td",{style:s,children:e.email||"-"}),(0,a.jsx)("td",{style:s,children:e.phone||"-"}),(0,a.jsx)("td",{style:s,children:e.status||"pending"}),(0,a.jsx)("td",{style:s,children:(0,a.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,a.jsx)("button",{disabled:u===e._id,onClick:()=>updateStatus(e._id,"approved"===e.status?"rejected":"approved"),style:o,children:u===e._id?"…":"approved"===e.status?"Reject":"Approve"}),(0,a.jsx)("button",{disabled:u===e._id,onClick:()=>deleteDealer(e._id),style:c,children:u===e._id?"…":"Delete"})]})})]},e._id))]})]})})]})}function DealersWithGuard(e){return(0,a.jsx)(n.Z,{children:(0,a.jsx)(AdminDealersPage,{...e})})}let r={textAlign:"left",padding:"12px 14px",fontSize:13,color:"#374151"},s={padding:"12px 14px",fontSize:14,color:"#111827"},l={padding:"8px 12px",background:"#f3f4f6",color:"#111827",border:"1px solid #e5e7eb",borderRadius:6,cursor:"pointer"},o={padding:"6px 10px",background:"#11294a",color:"#fff",borderRadius:6,border:"none",cursor:"pointer"},c={padding:"6px 10px",background:"#ef4444",color:"#fff",borderRadius:6,border:"none",cursor:"pointer"}}},function(e){e.O(0,[9774,2888,179],function(){return e(e.s=1515)}),_N_E=e.O()}]);