"use strict";(()=>{var e={};e.id=9059,e.ids=[9059],e.modules={1185:e=>{e.exports=require("mongoose")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},1281:(e,t,s)=>{s.r(t),s.d(t,{config:()=>m,default:()=>l,routeModule:()=>g});var a={};s.r(a),s.d(a,{default:()=>handler});var r=s(1802),n=s(7153),i=s(6249),o=s(3808),c=s(9787),d=s(8003),u=s(1185),p=s.n(u);async function handler(e,t){try{if(await (0,o.Z)(),"POST"!==e.method)return t.status(405).json({success:!1,message:"Only POST allowed"});let s=e.headers.authorization||"",a=s.startsWith("Bearer ")?s.split(" ")[1]:null,r=process.env.ADMIN_TOKEN||"ADMIN_SECURE_TOKEN",n=null;if(!a)return t.status(401).json({success:!1,message:"Missing token"});if(a===r)n="system";else try{let e=await d.Z.findById(a).select("_id email name");if(!e)return t.status(401).json({success:!1,message:"Invalid token"});n=e._id.toString()}catch(e){return t.status(401).json({success:!1,message:"Invalid token"})}let i=new(p()).Schema({adminId:{type:String},action:{type:String},targetType:{type:String},targetId:{type:String},before:{type:Object},after:{type:Object},reason:{type:String}},{timestamps:!0}),l=p().models.AdminAudit||p().model("AdminAudit",i),{propertyId:m,action:g,reason:y}=e.body;if(!m||!g)return t.status(400).json({success:!1,message:"propertyId and action required"});if(!u.Types.ObjectId.isValid(m))return t.status(400).json({success:!1,message:"Invalid propertyId"});let f=await c.Z.findById(m);if(!f)return t.status(404).json({success:!1,message:"Property not found"});let j=f.toObject(),v={};if("approve"===g)v={approved:!0,active:!0,rejectReason:null};else if("reject"===g)v={approved:!1,active:!1,rejectReason:y||"Rejected by admin"};else if("activate"===g)v={active:!0};else{if("deactivate"!==g)return t.status(400).json({success:!1,message:"Unknown action"});v={active:!1}}Object.assign(f,v),await f.save();let I=f.toObject();return await l.create({adminId:n,action:g,targetType:"property",targetId:m,before:j,after:I,reason:y||""}),t.status(200).json({success:!0,message:"Action applied",property:f})}catch(e){return console.error("PROPERTY ACTION ERROR:",e),t.status(500).json({success:!1,message:"Server error"})}}let l=(0,i.l)(a,"default"),m=(0,i.l)(a,"config"),g=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/admin/property-action",pathname:"/api/admin/property-action",bundlePath:"",filename:""},userland:a})}};var t=require("../../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[4222,9787,3638],()=>__webpack_exec__(1281));module.exports=s})();