"use strict";exports.id=3260,exports.ids=[3260],exports.modules={9721:(e,r,o)=>{o.d(r,{Z:()=>adminGuard});var n=o(1649);let parseList=(e="")=>e.split(",").map(e=>e.trim()).filter(Boolean),getAllowedOrigins=()=>parseList(process.env.ALLOWED_ADMIN_ORIGINS||""),getAllowedEmails=()=>parseList(process.env.ADMIN_ALLOWED_EMAILS||"");async function adminGuard(e,r){try{let o=e.headers?.origin||"",s=getAllowedOrigins();if(o){let e=o.replace(/\/+$/,""),n=e.startsWith("http://localhost")||e.startsWith("http://127.0.0.1"),t=n||s.includes(e)||s.includes(o);if(!t)return r.status(403).json({error:"Forbidden: origin not allowed"}),!1}let t=e.headers["x-admin-key"]||e.headers["admin-key"]||e.query?.adminKey;if(!t||t!==process.env.ADMIN_API_KEY)return r.status(401).json({error:"Unauthorized: invalid admin key"}),!1;let i=await (0,n.getSession)({req:e}),a=i?.user?.email||"",l=getAllowedEmails();if(l.length>0){if(!a)return r.status(401).json({error:"Unauthorized: login required"}),!1;if(!l.includes(a))return r.status(403).json({error:"Forbidden: admin email not allowed"}),!1}return!0}catch(e){return console.error("adminGuard error:",e),r.status(500).json({error:"Server error (adminGuard)"}),!1}}},3808:(e,r,o)=>{o.d(r,{Z:()=>a});var n=o(1185),s=o.n(n);let t=process.env.MONGODB_URI||"mongodb://localhost:27017/divine_acres";if(!t)throw Error("⛔ MONGODB_URI is missing in environment variables");let i=global.mongoose;async function dbConnect(){return i.conn||(i.promise||(i.promise=s().connect(t,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(e=>(console.log("✅ MongoDB Connected"),e)).catch(e=>{console.error("❌ MongoDB Connection Error:",e)})),i.conn=await i.promise),i.conn}i||(i=global.mongoose={conn:null,promise:null});let a=dbConnect}};